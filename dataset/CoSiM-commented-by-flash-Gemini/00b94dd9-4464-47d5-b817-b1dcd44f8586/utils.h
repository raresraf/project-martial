/**
 * @file utils.h
 * @brief This header file provides common utilities, data structures, and
 *        function prototypes for matrix solver implementations and testing.
 *
 * It defines types for solver functions, a structure for test case parameters,
 * and macros for random number generation.
 */

#include <stdio.h>   // For standard I/O operations (e.g., FILE, printf)
#include <stdlib.h>  // For general utilities (e.g., malloc, free, rand, srand)
#include <sys/time.h> // For time-related functions (e.g., gettimeofday)

/**
 * @typedef Solver
 * @brief Defines a function pointer type for a matrix solver function.
 *
 * A function of this type is expected to take the matrix dimension `N` and
 * two pointers to `double` arrays representing square matrices `A` and `B`,
 * and return a pointer to a newly allocated `double` array representing the
 * result matrix. The caller is responsible for freeing the returned memory.
 *
 * @param N The dimension of the square matrices (N x N).
 * @param A A pointer to the first input matrix.
 * @param B A pointer to the second input matrix.
 * @return A pointer to the dynamically allocated result matrix.
 */
typedef double* (*Solver)(int, double *, double*);

/**
 * @brief Macro to generate a random double-precision floating-point number within a symmetric range.
 *
 * Generates a random double value uniformly distributed within the range
 * `[-limit, +limit]`. Requires `rand()` to be seeded appropriately (e.g., with `srand()`).
 *
 * @param limit The positive maximum absolute value for the random number.
 * @return A random double value in `[-limit, limit]`.
 */
#define get_rand_double(limit) ((((double)rand()) / RAND_MAX) * (2 * limit) - limit)

/**
 * @struct test
 * @brief Structure to hold parameters for a single test case of a matrix solver.
 */
struct test {
	int seed; /**< Seed value for random number generation, ensuring reproducible test data. */
	int N;    /**< Dimension of the square matrices (N x N) for the test. */
	/**
	 * @brief File path to save the output matrix generated by the solver for this test case.
	 *        Used for verification and debugging.
	 */
	char output_save_file[100];
};

/**
 * @brief Prototype for the matrix solver function.
 *
 * This function is expected to take the matrix dimension `N` and two input
 * matrices `A` and `B`, performing a specific matrix computation and
 * returning the result matrix.
 *
 * @param N The dimension of the square matrices.
 * @param A A pointer to the first input matrix.
 * @param B A pointer to the second input matrix.
 * @return A pointer to the dynamically allocated result matrix.
 */
double* my_solver(int, double *, double *);

/**
 * @brief Prototype for a function to execute a single test case for a matrix solver.
 *
 * This function sets up a test environment, runs the provided `Solver` function,
 * and records its performance.
 *
 * @param test_case A `struct test` containing parameters for the current test.
 * @param solver_func A function pointer to the matrix solver implementation to test.
 * @param total_time A pointer to a float where the execution time will be stored.
 * @return An integer status code (e.g., 0 for success).
 */
int run_test(struct test, Solver, float *);

/**
 * @brief Prototype for a function to free dynamically allocated matrix data.
 *
 * @param data A pointer to a pointer to the matrix data to be freed.
 */
void free_data(double **);

/**
 * @brief Prototype for a function to generate random input data for a test case.
 *
 * This function populates matrices with random values based on `test_case` parameters.
 *
 * @param test_case A `struct test` containing parameters like seed and matrix dimension.
 * @param data A pointer to a pointer where the generated matrix data will be stored.
 * @param is_input A flag indicating if the data is for input matrices.
 * @return An integer status code (e.g., 0 for success).
 */
int generate_data(struct test, double **, int);

/**
 * @brief Prototype for a function to read test case parameters from an input file.
 *
 * This function parses an input file to extract parameters for multiple test cases.
 *
 * @param file_name The path to the input file.
 * @param num_tests A pointer to an integer where the number of read tests will be stored.
 * @param tests A pointer to a pointer where an array of `struct test` will be allocated and populated.
 * @return An integer status code (e.g., 0 for success).
 */
int read_input_file(char *, int *, struct test **);
